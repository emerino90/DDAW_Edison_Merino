{% extends "base.html" %}

{% block content %}
<div class="card">
  <div class="card__header" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
    <form action="{{ url_for('home') }}" method="get" class="searchbar">
      <input class="input" type="text" name="q" placeholder="Buscar por nombre…" value="{{ q or '' }}">
      <button class="btn btn-primary" type="submit">Buscar</button>
    </form>
    <a class="btn btn-primary" href="{{ url_for('nuevo') }}">Nuevo producto</a>
  </div>

  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>Nombre</th><th>Precio</th><th>Cantidad</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% if productos %}
          {% for p in productos %}
            <tr>
              <td>{{ p.id }}</td>
              <td class="text-strong">{{ p.nombre }}</td>
              <td>${{ '%.2f'|format(p.precio) }}</td>
              <td>{{ p.cantidad }}</td>
              <td class="actions">
                <a class="btn btn-ghost btn-small" href="{{ url_for('editar', pid=p.id) }}">Editar</a>
                <form action="{{ url_for('eliminar', pid=p.id) }}" method="post" onsubmit="return confirm('¿Eliminar {{p.nombre}}?')">
                  {{ delete_form.hidden_tag() }}
                  <button class="btn btn-danger btn-small">Eliminar</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="5">Sin productos.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <p style="margin-top:10px">
    <strong>Total ítems:</strong> {{ total_items }}
    · <strong>Valor total:</strong> ${{ '%.2f'|format(total_valor) }}
  </p>
</div>

<p style="color:var(--muted)">Semana 12 • CRUD + búsqueda + totales</p>
{% endblock %}
